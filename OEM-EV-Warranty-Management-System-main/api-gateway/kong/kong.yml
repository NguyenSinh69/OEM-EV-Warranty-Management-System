_format_version: "3.0"
_transform: true

services:
  # Customer Service
  - name: customer-service
    url: http://customer-service:8001
    tags: ["evm", "customer"]
    
  # Warranty Service  
  - name: warranty-service
    url: http://warranty-service:8002
    tags: ["evm", "warranty"]
    
  # Vehicle Service
  - name: vehicle-service
    url: http://vehicle-service:8003
    tags: ["evm", "vehicle"]
    
  # Admin Service
  - name: admin-service
    url: http://admin-service:8004
    tags: ["evm", "admin"]
    
  # Notification Service
  - name: notification-service
    url: http://notification-service:8005
    tags: ["evm", "notification"]

routes:
  # Health check route
  - name: health-check
    service: customer-service
    paths: ["/api/health"]
    methods: ["GET"]
    strip_path: false
    
  # Customer Service Routes
  - name: customer-routes
    service: customer-service
    paths: ["/api/customers"]
    methods: ["GET", "POST", "PUT", "DELETE"]
    strip_path: false
    
  - name: customer-auth
    service: customer-service
    paths: ["/api/auth"]
    methods: ["GET", "POST"]
    strip_path: false
    
  # Warranty Service Routes
  - name: warranty-routes
    service: warranty-service
    paths: ["/api/warranties"]
    methods: ["GET", "POST", "PUT", "DELETE"]
    strip_path: false
    
  - name: warranty-claims
    service: warranty-service
    paths: ["/api/claims"]
    methods: ["GET", "POST", "PUT", "DELETE"]
    strip_path: false
    
  # Vehicle Service Routes
  - name: vehicle-routes
    service: vehicle-service
    paths: ["/api/vehicles"]
    methods: ["GET", "POST", "PUT", "DELETE"]
    strip_path: false
    
  - name: vehicle-lookup
    service: vehicle-service
    paths: ["/api/vehicles/lookup"]
    methods: ["GET"]
    strip_path: false
    
  # Admin Service Routes
  - name: admin-routes
    service: admin-service
    paths: ["/api/admin"]
    methods: ["GET", "POST", "PUT", "DELETE"]
    strip_path: false
    
  - name: admin-policies
    service: admin-service
    paths: ["/api/policies"]
    methods: ["GET", "POST", "PUT", "DELETE"]
    strip_path: false
    
  # Notification Service Routes
  - name: notification-routes
    service: notification-service
    paths: ["/api/notifications"]
    methods: ["GET", "POST", "PUT", "DELETE"]
    strip_path: false

plugins:
  # CORS Plugin
  - name: cors
    config:
      origins: ["*"]
      methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
      headers: ["Accept", "Accept-Version", "Content-Length", "Content-MD5", "Content-Type", "Date", "X-Auth-Token", "Authorization"]
      exposed_headers: ["X-Auth-Token"]
      credentials: true
      max_age: 3600

  # Rate Limiting
  - name: rate-limiting
    config:
      minute: 100
      hour: 1000
      day: 10000
      
  # Request Size Limiting
  - name: request-size-limiting
    config:
      allowed_payload_size: 10

  # JWT Authentication (Global)
  - name: jwt
    route: customer-routes
    config:
      uri_param_names: ["jwt"]
      cookie_names: ["jwt"]
      header_names: ["Authorization"]
      claims_to_verify: ["exp"]
      
  - name: jwt
    route: warranty-routes
    config:
      uri_param_names: ["jwt"]
      cookie_names: ["jwt"]
      header_names: ["Authorization"]
      claims_to_verify: ["exp"]
      
  - name: jwt
    route: vehicle-routes
    config:
      uri_param_names: ["jwt"]
      cookie_names: ["jwt"]
      header_names: ["Authorization"]
      claims_to_verify: ["exp"]
      
  - name: jwt
    route: admin-routes
    config:
      uri_param_names: ["jwt"]
      cookie_names: ["jwt"]
      header_names: ["Authorization"]
      claims_to_verify: ["exp"]
      
  - name: jwt
    route: notification-routes
    config:
      uri_param_names: ["jwt"]
      cookie_names: ["jwt"]
      header_names: ["Authorization"]
      claims_to_verify: ["exp"]

consumers:
  - username: evm-admin
    custom_id: admin-001
    
  - username: evm-customer
    custom_id: customer-001
    
  - username: evm-staff
    custom_id: staff-001

jwt_secrets:
  - consumer: evm-admin
    key: admin-jwt-key
    secret: "your-admin-jwt-secret-key-here"
    
  - consumer: evm-customer
    key: customer-jwt-key
    secret: "your-customer-jwt-secret-key-here"
    
  - consumer: evm-staff
    key: staff-jwt-key
    secret: "your-staff-jwt-secret-key-here"
<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Login API</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light p-4">
    <div class="container">
      <h2>üîß Test Login & Register API</h2>

      <div class="row">
        <!-- Test Login -->
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h5>Test Login API</h5>
            </div>
            <div class="card-body">
              <button class="btn btn-primary" onclick="testLogin()">
                Test Login (admin/admin123)
              </button>
              <button class="btn btn-info ms-2" onclick="testAPI()">
                Test Basic API
              </button>
              <div id="loginResult" class="mt-3"></div>
            </div>
          </div>
        </div>

        <!-- Test Register -->
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-success text-white">
              <h5>Test Register API</h5>
            </div>
            <div class="card-body">
              <button class="btn btn-success" onclick="testRegister()">
                Test Register (testuser)
              </button>
              <div id="registerResult" class="mt-3"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-4">
        <h4>üìã Test Results:</h4>
        <div id="allResults" class="bg-white p-3 border rounded"></div>
      </div>

      <div class="mt-3">
        <h4>üîó Navigation Links:</h4>
        <a href="login.html" class="btn btn-outline-primary"
          >Go to Login Page</a
        >
        <a href="register.html" class="btn btn-outline-success ms-2"
          >Go to Register Page</a
        >
        <a href="index.html" class="btn btn-outline-info ms-2"
          >Go to Dashboard</a
        >
      </div>
    </div>

    <script>
      function logResult(message, type = "info") {
        const resultsDiv = document.getElementById("allResults");
        const timestamp = new Date().toLocaleTimeString();
        resultsDiv.innerHTML += `
                <div class="alert alert-${type} alert-sm mb-1">
                    <small><strong>${timestamp}:</strong> ${message}</small>
                </div>
            `;
        resultsDiv.scrollTop = resultsDiv.scrollHeight;
      }

      async function testAPI() {
        logResult("Testing basic API connection...", "info");

        try {
          // Test multiple potential endpoints
          const endpoints = [
            "http://localhost:8004/",
            "http://localhost:8004/api/test",
            "http://localhost:8004/index.php",
          ];

          for (const endpoint of endpoints) {
            try {
              const response = await fetch(endpoint);
              logResult(
                `‚úÖ ${endpoint} - Status: ${response.status}`,
                "success"
              );
            } catch (err) {
              logResult(`‚ùå ${endpoint} - Error: ${err.message}`, "danger");
            }
          }
        } catch (err) {
          logResult(`‚ùå API Test Failed: ${err.message}`, "danger");
        }
      }

      async function testLogin() {
        logResult("Testing login API...", "info");

        try {
          const response = await fetch("http://localhost:8004/api/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              username: "admin",
              password: "admin123",
            }),
          });

          const result = await response.text();
          logResult(
            `Login Response Status: ${response.status}`,
            response.ok ? "success" : "warning"
          );
          logResult(`Login Response: ${result}`, "info");

          document.getElementById("loginResult").innerHTML = `
                    <div class="alert alert-${
                      response.ok ? "success" : "danger"
                    }">
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>Response:</strong> ${result}
                    </div>
                `;
        } catch (err) {
          logResult(`‚ùå Login Test Failed: ${err.message}`, "danger");
          document.getElementById("loginResult").innerHTML = `
                    <div class="alert alert-danger">
                        <strong>Error:</strong> ${err.message}
                    </div>
                `;
        }
      }

      async function testRegister() {
        logResult("Testing register API...", "info");

        try {
          const testUser = {
            username: "testuser_" + Date.now(),
            password: "testpass123",
            role: "EVM_Staff",
          };

          const response = await fetch("http://localhost:8004/api/users", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(testUser),
          });

          const result = await response.text();
          logResult(
            `Register Response Status: ${response.status}`,
            response.ok ? "success" : "warning"
          );
          logResult(`Register Response: ${result}`, "info");

          document.getElementById("registerResult").innerHTML = `
                    <div class="alert alert-${
                      response.ok ? "success" : "danger"
                    }">
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>Response:</strong> ${result}
                    </div>
                `;
        } catch (err) {
          logResult(`‚ùå Register Test Failed: ${err.message}`, "danger");
          document.getElementById("registerResult").innerHTML = `
                    <div class="alert alert-danger">
                        <strong>Error:</strong> ${err.message}
                    </div>
                `;
        }
      }

      // Auto-run basic API test on page load
      window.addEventListener("load", () => {
        logResult("üöÄ Test page loaded. Ready to test APIs!", "success");
        testAPI();
      });
    </script>
  </body>
</html>
